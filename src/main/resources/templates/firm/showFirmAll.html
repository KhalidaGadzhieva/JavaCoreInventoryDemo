<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Show all Firms</title>
    <link rel="stylesheet" th:href="@{/firmStyles/stylesFirmTable.css}">
    <link rel="stylesheet" th:href="@{/firmStyles/modalForDelete.css}">

</head>
<body>
    <h2>All firms</h2>
    <a href="/firm/new" class="btn add-firm-btn">Add New Firm</a>

<div class="table-wrapper">
    <div class="table-wrapper table-11cols">

    <table>
    <thead>
    <tr>
        <th>ID</th>
        <th>NAME</th>
        <th>INN</th>
        <th>EMAIL</th>
        <th>MOBILE_NUMBER</th>
        <th>ADDRESS_COUNTRY</th>
        <th>ADDRESS_CITY</th>
        <th>ADDRESS_STREET</th>
        <th>ADDRESS_HOUSE_NUMBER</th>
        <th>OutstandingDebt</th>
        <th>INVOICES</th>


        <th>OTHER</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="firm : ${firmList}">
        <td> <a th:href="@{/firm/get/{id}(id=${firm.id})}" th:text="${firm.id}" class="btn"></a></td>

        <td th:text="${firm.name}"></td>
        <td th:text="${firm.inn}"></td>
        <td th:text="${firm.email}"></td>
        <td th:text="${firm.mobileNumber}"></td>
        <td th:text="${firm.address.getCountry()}"></td>
        <td th:text="${firm.address.getCity()}"></td>
        <td th:text="${firm.address.getStreet()}"></td>
        <td th:text="${firm.address.getHouseNumber()}"></td>
        <td  th:text="${firm.outstandingDebt}"></td>

        <td>
            <a th:href="@{firm/{id}/invoices(id=${firm.id})}">
                <button class="view-button">Show</button>
            </a>
        </td>
        <td>
            <a th:href="@{/firm/edit/{id}(id=${firm.id})}" class="btn">Edit</a>
            <button class="btn btn-danger" th:attr="onclick=|openModal(${firm.id})|">Delete</button>
        </td>
    </tr>
    </tbody>
</table>
    </div>
</div>
<a href="/user/home" class="btn back-home-btn">Back to home</a>
<div id="deleteModal" class="modal">
    <div class="modal-content">
        <p>Are you sure you want to delete this Firm?</p>
        <form id="deleteForm" method="post" >
            <input type="hidden" name="_method" value="delete"/>
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
            <button type="submit" class="confirm-btn">Yes</button>
            <button type="button" class="cancel-btn" onclick="closeModal()">No</button>
        </form>
    </div>
</div>
<script>
    // Показывает модальное окно и вставляет ID в action формы
    function openModal(firmId) {
        const modal = document.getElementById('deleteModal');
        const form = document.getElementById('deleteForm');
        form.setAttribute('action', '/firm/delete/' + firmId);
        modal.style.display = 'block';
    }

    // Закрывает модалку
    function closeModal() {
        document.getElementById('deleteModal').style.display = 'none';
    }

    // Закрывает по клику вне окна
    window.onclick = function(event) {
        const modal = document.getElementById('deleteModal');
        if (event.target === modal) {
            modal.style.display = 'none';
        }
    }
</script>
</body>
</html>
